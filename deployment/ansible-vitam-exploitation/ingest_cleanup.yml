---

# Confirm launching this playbook
- hosts: localhost
  any_errors_fatal: yes
  vars_prompt:
    name: "confirmation"
    prompt: "Are you sure you want to run this playbook? \n /!\\ WARNING : PLEASE RUN THIS SCRIPT ONLY FOR CLEANING A CORRUPTED INGEST OPERATION AND THAT IT IS ELIGIBLE FOR CLEANUP.\n Answer with 'YES' / 'NO'"
    default: "NO"
    private: no
  tasks:
    - name: Check Confirmation
      fail: msg="Playbook run confirmation failed"
      when: confirmation|upper != "YES"

  # Check parameters
- hosts: localhost
  any_errors_fatal: yes
  tasks:
    - name: "Check operation id format"
      assert:
        that:
          - ingestOperationId is match('^[a-z0-9]{36}$')

    - name: "Check tenant Id"
      fail: msg="Invalid tenant Id."
      when: "{{ tenantId }} not in {{ vitam_tenant_ids }}"

# Run
- hosts: hosts_functional_administration
  roles:
    - ingest_cleanup
