---
- import_playbook: stop_external.yml

- hosts: hosts-metadata
  roles:
    - upgrade_R6_metadata

- hosts: all
  any_errors_fatal: yes
  vars_prompt:
    name: "confirmation"
    prompt: "Did metdata upgrade run successfully (please have a look at logbook logs ) ? Answer with 'YES'"
    default: "NO"
    private: no
  tasks:
    - name: Check Confirmation
      fail: msg="Playbook run confirmation failed"
      when: confirmation|upper != "YES"

- hosts: hosts-mongos-data
  roles:
    - upgrade_R6_contexts

- hosts: hosts-functional-administration
  roles:
    - upgrade_R6_reindex_ES_data

- hosts: hosts-functional-administration
  roles:
    - upgrade_R6_functionaladministration

- import_playbook: start_external.yml
