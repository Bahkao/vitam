---
- name: set fact 
  set_fact:
    cluster_ES: hosts-{{ vitam_struct.cluster_name }}

- name: Get {{ vitam_struct.cluster_name }} state 
  uri:
    url: http://{{ vitam_struct.host }}:{{ vitam_struct.port_http }}/_cluster/health
    return_content: true 
  register: ES_state
  run_once: true 
  delegate_to: "{{groups[cluster_ES][0]}}"

- name: save current state in {{ inventory_dir }}
  copy: 
    content: "{{ ES_state }}"
    dest: "{{inventory_dir}}/troubleshoot/{{ vitam_struct.cluster_name }}.json"
  run_once: true 
  delegate_to: "{{groups[cluster_ES][0]}}"


