---

- name: Copy the database scripts files
  template:
    src: "update-contexts.js.j2"
    dest: "{{ vitam_defaults.folder.root_path }}/app/mongos/update-contexts.js"
    owner: "{{ vitam_defaults.users.vitamdb }}"
    group: "{{ vitam_defaults.users.group }}"
    mode: "{{ vitam_defaults.folder.conf_permission }}"
  when:
    - "mongo_cluster_name == 'mongo-data'"

- name: update contexts tenant directive directly in mongo
  command: "mongo {{ ip_service }}:{{ mongodb.mongos_port }}/admin -u {{ mongodb[mongo_cluster_name].admin.user }} -p {{ mongodb[mongo_cluster_name].admin.password }} --quiet {{ vitam_defaults.folder.root_path }}/app/mongos/update-contexts.js"
  when: "mongo_cluster_name == 'mongo-data'"
  run_once: true

