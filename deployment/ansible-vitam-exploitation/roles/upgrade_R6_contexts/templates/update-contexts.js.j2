
// Switch to masterdata database
db = db.getSiblingDB('masterdata')

// Create indexes
// A single collection can have no more than 64 indexes.

//db.Context.updateMany( {}, { $rename: { "Permissions._tenant": "Permissions.tenant" } } )
//db.Context.update({"Permissions._tenant": {$exists: true}}, {$rename:{"Permissions._tenant":"Permissions.tenant"}}, false, true);

db.Context.find({ 'Permissions._tenant': { $exists: 1 } }).snapshot().forEach(function(item)
{
   for(i = 0; i != item.Permissions.length; ++i)
   {
       item.Permissions[i].tenant = NumberInt(item.Permissions[i]._tenant);
       delete item.Permissions[i]._tenant;
   }
   db.Context.update({_id: item._id}, item);
});


// Update Context status
db.Context.find({}).snapshot().forEach(function(item)
{
   if (item.Status==true){
      item.Status="ACTIVE";
   }
   else  if (item.Status==false){     
      item.Status="INACTIVE";
   }
   db.Context.update({_id: item._id}, item);
});
