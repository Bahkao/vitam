---
# tasks file for vitam_autotest
- name: check autotest for {{ vitam_component }} component on port {{ port }}
  uri:
    url: '{{ protocol }}://{{ hote }}:{{ check_port }}/admin/v1/autotest'
    method: GET
    status_code: 200
    validate_certs: no
    return_content: yes
    timeout: "{{ vitam_defaults.services.api_call_timeout }}"
  register: response

# commented as all components are not yet with autotest
# - action: fail
#   when: response | failed

- debug: var=(response.json.message)
  when: response is succeeded 

- name: fail if not OK
  fail:
    msg: "{{ response.json.message }}"
  when: response is failed

- name: fail if not correct response
  fail:
    msg: "{{ response.json.message }}"
  when: response.json.message != 'All services are available'