---

- name: ensure {{ inventory_dir }}/troubleshoot/{{ inventory_hostname }} exists to get back log files
  local_action:
    module: file
    path: "{{ inventory_dir }}/troubleshoot/{{ inventory_hostname }}/{{ vitam_struct.vitam_component }}"
    state: directory
    mode: 0777

# - name    : list files from {{ vitam_defaults.folder.root_path }}/log/{{ vitam_struct.vitam_component }}
#   shell   : find {{ vitam_defaults.folder.root_path }}/log/{{ vitam_struct.vitam_component }}/ -type f -mtime -2  -printf '%f\n'
#   register: path_files

- name: list files from {{ vitam_defaults.folder.root_path }}/log/{{ vitam_struct.vitam_component }}
  find:
    paths: "{{ vitam_defaults.folder.root_path }}/log/{{ vitam_struct.vitam_component }}"
    age: "-{{ age }}d"
    recurse: no # no subdir
    file_type: file
  register: path_files

- name: fetch log files from {{ vitam_struct.vitam_component }}
  fetch:
    src: "{{ item.path }}"
    dest: "{{ inventory_dir }}/troubleshoot/{{ inventory_hostname }}/{{ vitam_struct.vitam_component }}/"
    flat: yes
  with_items: "{{ path_files.files }}"
