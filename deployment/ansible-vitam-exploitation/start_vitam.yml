---

### HOSTS NETWORK VARS CHECK ###
- hosts: hosts
  roles:
    - check_networks

# consul start
- hosts: hosts-consul-server
  serial: 1
  roles:
    - service
  vars:
    state: started
    name: vitam-consul

- hosts: vitam
  roles:
    - service
  vars:
    state: started
    name: vitam-consul

# log-central start
- hosts: hosts-elasticsearch-log
  roles:
    - service
  vars:
    state: started
    name: vitam-elasticsearch-log
    hote: "{{ip_admin}}"
    port_check: "{{ elasticsearch.elasticsearch_log.tcp_port }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-logstash
  roles:
    - service
  vars:
    state: started
    name: logstash
    hote: "{{ip_admin}}"
    port_check: "{{logstash.port}}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-kibana-log
  roles:
    - service
  vars:
    state: started
    name: kibana
    hote: "{{ ip_service }}"
    port_check: "{{kibana.log_port}}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

# Databases start
- hosts: mongoc
  roles:
    - service
  vars:
    state: started
    name: vitam-mongoc
    hote: "{{ ip_service }}"
    port_check: "{{ mongodb.mongoc_port }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: mongod
  roles:
    - service
  vars:
    state: started
    name: vitam-mongod
    hote: "{{ ip_service }}"
    port_check: "{{ mongodb.mongod_port }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: mongos
  roles:
    - service
  vars:
    state: started
    name: vitam-mongos
    hote: "{{ ip_service }}"
    port_check: "{{ mongodb.mongos_port }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-elasticsearch-data
  roles:
    - service
  vars:
    state: started
    name: vitam-elasticsearch-data
    hote: "{{ ip_service }}"
    port_check: "{{ elasticsearch.elasticsearch_data.tcp_port }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-kibana-data
  roles:
    - service
  vars:
    state: started
    name: kibana
    hote: "{{ ip_service }}"
    port_check: "{{kibana_data_port}}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-storage-offer-default
  roles:
    - service
  vars: 
    state: started
    name: vitam-offer
    #vitam_struct: "{{ vitam.storageofferdefault }}"
    hote: "{{ ip_service }}"
    port_check: "{% if vitam.storageofferdefault.https_enabled==true %}{{vitam.storageofferdefault.port_https}}{% else %}{{vitam.storageofferdefault.port}}{% endif %}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-storage-engine
  roles:
    - service
  vars:
    state: started
    vitam_struct: "{{ vitam.storageengine }}"
    name: vitam-storage
    hote: "{{ ip_service }}"
    port_check: "{{ vitam.storageengine.port }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-metadata
  roles:
    - service
  vars:
    state: started
    name: vitam-metadata
    hote: "{{ ip_service }}"
    port_check: "{{ vitam.metadata.port }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-workspace
  roles:
    - service
  vars:
    state: started
    name: vitam-workspace
    hote: "{{ ip_service }}"
    port_check: "{{ vitam.workspace.port }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-logbook
  roles:
    - service
  vars:
    state: started
    name: vitam-logbook
    hote: "{{ ip_service }}"
    port_check: "{{ vitam.logbook.port }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-functional-administration
  roles:
    - service
  vars:
    state: started
    name: vitam-functional-administration
    hote: "{{ ip_service }}"
    port_check: "{{ vitam.functional_administration.port}}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-processing
  roles:
    - service
  vars:
    state: started
    name: vitam-processing
    hote: "{{ ip_service }}"
    port_check: "{{vitam.processing.port}}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-worker
  roles:
    - {role: service, state: started, name: vitam-siegfried}
    - {role: service, state: started, name: vitam-worker, hote: "{{ ip_service }}", port_check: "{{vitam.worker.port}}", timeout: "{{ vitam_defaults.services.start_timeout }}"}

- hosts: hosts-access-internal
  roles:
    - service
  vars:
    state: started
    name: vitam-access-internal
    hote: "{{ ip_service }}"
    port_check: "{{vitam.accessinternal.port}}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-access-external
  roles:
    - service
  vars:
    state: started
    name: vitam-access-external
    hote: "{{ ip_service }}"
    port_check: "{{vitam.accessexternal.port_https}}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-ingest-internal
  roles:
    - service
  vars:
    state: started
    name: vitam-ingest-internal
    hote: "{{ ip_service }}"
    port_check: "{{vitam.ingestinternal.port}}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-ingest-external
  roles:
    - {role: service, state: started, name: vitam-siegfried}
    - {role: service, state: started, name: vitam-ingest-external, hote: "{{ ip_service }}", port_check: "{{vitam.ingestexternal.port_https}}", timeout: "{{ vitam_defaults.services.start_timeout }}"}

- hosts: hosts-ihm-demo
  roles:
    - service
  vars:
    state: started
    name: vitam-ihm-demo
    hote: "{{ ip_service }}"
    port_check: "{{vitam.ihm_demo.port}}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"
