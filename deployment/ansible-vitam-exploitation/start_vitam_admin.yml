---

- hosts: hosts-consul-server
  any_errors_fatal: true
  serial: 1
  roles:
    - service
  vars:
    state: "{% if 'consul' not in vitam_secondary_site_components and primary_site| lower == 'false' %}stopped{% else %}started{% endif %}"
    name: vitam-consul

- hosts: vitam
  any_errors_fatal: true
  serial: 1
  roles:
    - service
  vars:
    state: "{% if 'consul' not in vitam_secondary_site_components and primary_site| lower == 'false' %}stopped{% else %}started{% endif %}"
    name: vitam-consul

# log-central start
- hosts: hosts-elasticsearch-log
  any_errors_fatal: true
  roles:
    - service
  vars:
    state: "{% if 'elasticsearch-log' not in vitam_secondary_site_components and primary_site| lower == 'false' %}stopped{% else %}started{% endif %}"
    name: vitam-elasticsearch-log
    hote: "{{ ip_admin }}"
    port_check: "{{ elasticsearch.log.port_tcp }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-logstash
  any_errors_fatal: true
  roles:
    - service
  vars:
    state: "{% if 'logstash' not in vitam_secondary_site_components and primary_site| lower == 'false' %}stopped{% else %}started{% endif %}"
    name: logstash
    hote: "{{ ip_admin }}"
    port_check: "{{ logstash.port }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-kibana-log
  any_errors_fatal: true
  roles:
    - service
  vars:
    state: "{% if 'kibana' not in vitam_secondary_site_components and primary_site| lower == 'false' %}stopped{% else %}started{% endif %}"
    name: kibana
    hote: "{{ ip_admin }}"
    port_check: "{{ kibana.log.port }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"

- hosts: hosts-cerebro
  roles:
    - service
  vars:
    state: started
    name: vitam-elasticsearch-cerebro

- hosts: hosts-dev-tools
  roles:
    - docker
  vars:
    name: "mongo-express"
    state: started

- hosts: hosts-dev-tools
  roles:
    - docker
  vars:
    name: "elasticsearch-head"
    state: started
