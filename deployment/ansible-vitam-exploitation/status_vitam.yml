---
### HOSTS NETWORK VARS CHECK ###
- hosts: hosts
  roles:
    - checks

### consul servers
- hosts: hosts-consul-server
  roles:
    - vitam_check_port
  vars:
    vitam_component: "consul"
    hote: "{{ ip_admin }}"
    port: "8500"

### consul agents
- hosts: vitam
  roles:
    - { role: vitam_check_port, when: consul_disabled is not defined or consul_disabled |lower != 'true' }
  vars:
    vitam_component: "consul"
    hote: "{{ ip_admin }}"
    port: "8301"

### ES data
- hosts: hosts-elasticsearch-data
  roles:
    - vitam_check_port
  vars:
    vitam_component: "elasticsearch-data"
    hote: "{{ ip_service }}"
    port: "{{ elasticsearch.data.port_http }}"

- hosts: hosts-elasticsearch-data
  roles:
    - vitam_check_port
  vars:
    vitam_component: "elasticsearch-data"
    hote: "{{ ip_service }}"
    port: "{{ elasticsearch.data.port_tcp }}"

### ES log
- hosts: hosts-elasticsearch-log
  roles:
    - vitam_check_port
  vars:
    vitam_component: "elasticsearch-log"
    hote: "{{ ip_admin }}"
    port: "{{ elasticsearch.log.port_http }}"

- hosts: hosts-elasticsearch-log
  roles:
    - vitam_check_port
  vars:
    vitam_component: "elasticsearch-log"
    hote: "{{ ip_admin }}"
    port: "{{ elasticsearch.log.port_tcp }}"

### mongoDB data
- hosts: hosts-mongoc-data
  roles:
    - vitam_check_port
  vars:
    vitam_component: "mongoc"
    hote: "{{ ip_service }}"
    port: "{{ mongodb.mongoc_port }}"

- hosts: hosts-mongod-data
  roles:
    - vitam_check_port
  vars:
    vitam_component: "mongod"
    hote: "{{ ip_service }}"
    port: "{{ mongodb.mongod_port }}"

- hosts: hosts-mongos-data
  roles:
    - vitam_check_port
  vars:
    vitam_component: "mongos"
    hote: "{{ ip_service }}"
    port: "{{ mongodb.mongos_port }}"

### mongoDB offer

- hosts: hosts-mongoc-offer
  roles:
    - vitam_check_port
  vars:
    vitam_component: "mongoc"
    hote: "{{ ip_service }}"
    port: "{{ mongodb.mongoc_port }}"

- hosts: hosts-mongod-offer
  roles:
    - vitam_check_port
  vars:
    vitam_component: "mongod"
    hote: "{{ ip_service }}"
    port: "{{ mongodb.mongod_port }}"

- hosts: hosts-mongos-offer
  roles:
    - vitam_check_port
  vars:
    vitam_component: "mongos"
    hote: "{{ ip_service }}"
    port: "{{ mongodb.mongos_port }}"




### offer
- hosts: hosts-storage-offer-default
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: offer
    hote: "{{ ip_admin }}"
    port: "{{ vitam.storageofferdefault.port_admin }}"

### storage engine
- hosts: hosts-storage-engine
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: storage
    hote: "{{ ip_admin }}"
    port: "{{ vitam.storageengine.port_admin }}"

### metadata
- hosts: hosts-metadata
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: metadata
    hote: "{{ ip_admin }}"
    port: "{{ vitam.metadata.port_admin }}"

### logbook
- hosts: hosts-logbook
  any_errors_fatal: false
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: logbook
    hote: "{{ ip_admin }}"
    port: "{{ vitam.logbook.port_admin }}"

### workspace
- hosts: hosts-workspace
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: workspace
    hote: "{{ ip_admin }}"
    port: "{{ vitam.workspace.port_admin }}"

### functional administration
- hosts: hosts-functional-administration
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: functional-administration
    hote: "{{ ip_admin }}"
    port: "{{ vitam.functional_administration.port_admin }}"

### security internal
- hosts: hosts-security-internal
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: security-internal
    hote: "{{ ip_admin }}"
    port: "{{ vitam.security_internal.port_admin }}"

### processing
- hosts: hosts-processing
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: processing
    hote: "{{ ip_admin }}"
    port: "{{ vitam.processing.port_admin }}"

### batch report
- hosts: hosts-batch-report
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: batch-report
    hote: "{{ ip_admin }}"
    port: "{{ vitam.batchreport.port_admin }}"

### worker
- hosts: hosts-worker
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: worker
    hote: "{{ ip_admin }}"
    port: "{{ vitam.worker.port_admin }}"

### access-internal
- hosts: hosts-access-internal
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: access-internal
    hote: "{{ ip_admin }}"
    port: "{{ vitam.accessinternal.port_admin }}"

### access-external
- hosts: hosts-access-external
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: access-external
    hote: "{{ ip_admin }}"
    port: "{{ vitam.accessexternal.port_admin }}"

### Ingest-internal
- hosts: hosts-ingest-internal
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: ingest-internal
    hote: "{{ ip_admin }}"
    port: "{{ vitam.ingestinternal.port_admin }}"

### Ingest-external
- hosts: hosts-ingest-external
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: ingest-external
    hote: "{{ ip_admin }}"
    port: "{{ vitam.ingestexternal.port_admin }}"

### ihm-demo
- hosts: hosts-ihm-demo
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: ihm-demo
    hote: "{{ ip_admin }}"
    port: "{{ vitam.ihm_demo.port_admin }}"

### ihm-demo
- hosts: hosts-ihm-recette
  roles:
    - { role: vitam_autotest, when: ( primary_site | lower == "true" ) or ( vitam_struct.vitam_component in vitam_secondary_site_components ) }
  vars:
    vitam_component: ihm-recette
    hote: "{{ ip_admin }}"
    port: "{{ vitam.ihm_recette.port_admin }}"
