---

### HOSTS NETWORK VARS CHECK ###
- hosts: hosts
  roles:
    - check_networks

# Vitam apps stop

- hosts: hosts-ihm-demo
  roles:
    - {role: service, state: stopped, name: vitam-ihm-demo, hote: "{{ip_service}}", port_check: "{{vitam_ihm_demo_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-ingest-external
  roles:
    - {role: service, state: stopped, name: vitam-ingest-external, hote: "{{ip_service}}", port_check: "{{vitam_ingestexternal_port_https}}", timeout: "{{service_stop_timeout}}"}
    - {role: service, state: stopped, name: vitam-siegfried}

- hosts: hosts-ingest-internal
  roles:
    - {role: service, state: stopped, name: vitam-ingest-internal, hote: "{{ip_service}}", port_check: "{{vitam_ingestinternal_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-access-external
  roles:
    - {role: service, state: stopped, name: vitam-access-external, hote: "{{ip_service}}", port_check: "{{vitam_accessexternal_port_https}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-access-internal
  roles:
    - {role: service, state: stopped, name: vitam-access-internal, hote: "{{ip_service}}", port_check: "{{vitam_accessinternal_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-worker
  roles:
    - {role: service, state: stopped, name: vitam-worker, hote: "{{ip_service}}", port_check: "{{vitam_worker_port}}", timeout: "{{service_stop_timeout}}"}
    - {role: service, state: stopped, name: vitam-siegfried}

- hosts: hosts-processing
  roles:
    - {role: service, state: stopped, name: vitam-processing, hote: "{{ip_service}}", port_check: "{{vitam_processing_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-functional-administration
  roles:
    - {role: service, state: stopped, name: vitam-functional-administration, hote: "{{ip_service}}", port_check: "{{vitam_functional_administration_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-logbook
  roles:
    - {role: service, state: stopped, name: vitam-logbook, hote: "{{ip_service}}", port_check: "{{vitam_logbook_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-workspace
  roles:
    - {role: service, state: stopped, name: vitam-workspace, hote: "{{ip_service}}", port_check: "{{vitam_workspace_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-metadata
  roles:
    - {role: service, state: stopped, name: vitam-metadata, hote: "{{ip_service}}", port_check: "{{vitam_metadata_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-storage-engine
  roles:
    - {role: service, state: stopped, name: vitam-storage, hote: "{{ip_service}}", port_check: "{{vitam_storageengine_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-storage-offer-default
  roles:
    - {role: service, state: stopped, name: vitam-offer, hote: "{{ip_service}}", port_check: "{% if test_tls_offer_enabled==true %}{{vitam_storageofferdefault_port_https}}{% else %}{{vitam_storageofferdefault_port}}{% endif %}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-mongoclient
  roles:
    - {role: service, state: stopped, name: vitam-mongoclient, hote: "{{ip_service}}", port_check: "{{mongoclientPort}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-kibana-data
  roles:
    - {role: service, state: stopped, name: kibana, hote: "{{ip_service}}", port_check: "{{kibana_data_port}}", timeout: "{{service_stop_timeout}}"}


# Databases stop

- hosts: hosts-elasticsearch-data
  roles:
    - {role: service, state: stopped, name: vitam-elasticsearch-data, hote: "{{ip_service}}", port_check: "{{elasticsearch_data_tcp_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: mongos
  roles:
    - {role: service, state: stopped, name: vitam-mongos, hote: "{{ip_service}}", port_check: "{{mongos_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: mongod
  roles:
    - {role: service, state: stopped, name: vitam-mongod, hote: "{{ip_service}}", port_check: "{{mongod_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: mongoc
  roles:
    - {role: service, state: stopped, name: vitam-mongoc, hote: "{{ip_service}}", port_check: "{{mongoc_port}}", timeout: "{{service_stop_timeout}}"}


# log-central stop
- hosts: hosts-kibana-log
  roles:
    - {role: service, state: stopped, name: kibana, hote: "{{ip_service}}", port_check: "{{kibana_log_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-logstash
  roles:
    - {role: service, state: stopped, name: logstash, hote: "{{ip_admin}}", port_check: "{{vitam_logstash_port}}", timeout: "{{service_stop_timeout}}"}

- hosts: hosts-elasticsearch-log
  roles:
    - {role: service, state: stopped, name: vitam-elasticsearch-log, hote: "{{ip_admin}}", port_check: "{{elasticsearch_log_tcp_port}}", timeout: "{{service_stop_timeout}}"}


# consul stop
- hosts: vitam
  roles:
    - {role: service, state: stopped, name: vitam-consul}

- hosts: hosts-consul-server
  serial: 1
  roles:
    - {role: service, state: stopped, name: vitam-consul}
