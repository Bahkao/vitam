---

- name: Install rpm
  yum:
    name: mongodb-org-server
    state: present

- name: Listen on all interface
  lineinfile:
    dest: /etc/mongod.conf
    regexp: "bindIp:"
    state: absent

- name: change mongod to syslog behavior
  replace: 
    dest: /etc/mongod.conf
    regexp: '^.*destination:.*$'
    replace: '  destination: syslog'

- name: define facility {{syslog_facility}} for syslog output
# syslogFacility:
  lineinfile:
    dest: /etc/mongod.conf
    regexp: "^  syslogFacility:" 
    insertafter: "^  destination: syslog" 
    line: "  syslogFacility: {{syslog_facility}}"

- name: remove log file
  replace: 
    dest: /etc/mongod.conf
    regexp: '^.*path:.*$'
    replace: '  #path:'    

- name: add syslog option
  replace: 
    dest: /etc/sysconfig/mongod
    regexp: '^# OPTIONS=.*$'
    replace: 'OPTIONS=" -f /etc/mongod.conf --syslog "' 

- name: (re-)start mongodb
  service: 
    name: mongod
    enabled: true
    state: restarted
