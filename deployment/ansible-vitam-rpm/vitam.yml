---

# Vitam solution deployment
- hosts: hosts
  roles:
    - {role: init_vitam_dir, when: vitam_environment=='local'}

# mongodb commons (yum install, etc...)
- hosts: mongo_common
  roles:
  - role: mongo_common

# Mongoc replicas configuration
- hosts: mongoc
  roles:
    - {role: mongoc, mongo_bin: mongod}

# Mongod replicas configuration
- hosts: mongod
  roles:
    - {role: mongod, mongo_bin: mongod, shard_id: 0}

# Mongos configuration & mongo cluster configuration
- hosts: mongos
  roles:
    - {role: mongos, mongo_bin: mongos}

# # MongoDB installation
# - hosts: hosts-mongodb
#   roles:
#     - mongodb

# ElasticSearch-data installation
- hosts: hosts-elasticsearch-data
  roles:
    - {role: elasticsearch-cluster, cluster_name: elasticsearch-data , port_http: "{{elasticsearch_data_http_port}}", port_tcp: "{{elasticsearch_data_tcp_port}}", groupe: data }

- hosts: hosts-elasticsearch-log
  roles:
    - {role: elasticsearch-cluster, cluster_name: elasticsearch-log , port_http: "{{elasticsearch_log_http_port}}", port_tcp: "{{elasticsearch_log_tcp_port}}", groupe: log, when: vitam_environment != 'local' }

# Consul installation
- hosts: hosts-consul-server
  serial: 1
  roles:
    - {role: consul, server: true } 




## VITAM ###################################################################################""
- hosts: hosts-logbook
  roles:
    - {role: vitam, vitam_component: logbook, java_args: /vitam/conf/logbook/logbook.conf, port_http: "{{vitam_logbook_port}}" } 

- hosts: hosts-metadata
  roles:
    - {role: vitam, vitam_component: metadata, java_args: /vitam/conf/metadata/metadata.conf, port_http: "{{vitam_metadata_port}}", cluster_name: elasticsearch-data } 

- hosts: hosts-workspace
  roles:
    - {role: vitam, vitam_component: workspace ,java_args: /vitam/conf/workspace/workspace.conf, port_http: "{{vitam_workspace_port}}" }


- hosts: hosts-ingest
  roles:
    - {role: vitam, vitam_component: ingest-internal, java_args: /vitam/conf/ingest-internal/ingest-internal.conf, port_http: "{{vitam_ingest_port}}" } 

- hosts: hosts-ingest-external
  roles:
    - siegfried
    - {role: vitam, vitam_component: ingest-external, java_args: /vitam/conf/ingest-external/ingest-external.conf, port_http: "{{vitam_ingestexternal_port}}", tls_active: true }
    - ingest-external

- hosts: hosts-processing
  roles:
    - {role: vitam, vitam_component: processing,java_args: /vitam/conf/processing/processing.conf, port_http: "{{vitam_processing_port}}" } 

- hosts: hosts-worker
  roles:
    - siegfried
    - {role: vitam, vitam_component: worker,java_args: /vitam/conf/worker/worker.conf, port_http: "{{vitam_worker_port}}" } 

- hosts: hosts-access
  roles:
    - {role: vitam, vitam_component: access, java_args: /vitam/conf/access/access.conf, port_http: "{{vitam_access_port}}" } 

- hosts: hosts-ihm-demo
  roles:
    - {role: vitam, vitam_component: ihm-demo, java_args: /vitam/conf/ihm-demo/ihm-demo.conf, port_http: "{{vitam_ihm_demo_port}}" } 

- hosts: hosts-storage-engine
  roles:
    - {role: vitam, vitam_component: storage, java_args: /vitam/conf/storage/storage-engine.conf, port_http: "{{vitam_storageengine_port}}" }
    - storage

- hosts: hosts-storage-offer-default
  roles:
    - {role: vitam, vitam_component: storage-offer-default, java_args: /vitam/conf/storage-offer-default/default-offer.conf, port_http: "{{vitam_storageofferdefault_port}}" }

- hosts: hosts-functional-administration
  roles:
    - {role: vitam, vitam_component: functional-administration, java_args: /vitam/conf/functional-administration/functional-administration.conf, port_http: "{{vitam_functional_administration_port}}" }

- hosts: hosts-log-server
  roles:
    - {role: log-server, cluster_name: elasticsearch-log, when: vitam_environment != 'local'}

