---
# tasks file for docker-raz
- name: stop all VITAM containers from {{docker_registry_hostname}} (except mongo)
  docker: 
    name="{{item}}-{{vitam_environment}}"
    image="{{docker_registry_hostname}}/vitam/{{item}}:{{vitam_docker_tag}}"
    signal=KILL
    state=stopped
  with_items:
  - "access"
  - "ihm-demo"
  - "ingest"
  - "ingest-web"
  - "logbook"
  - "metadata"
  - "processing"
  - "workspace"
  - "ingest-external"
  - "storage-engine"
  - "storage-offer-default"
  ignore_errors: true

- name: stop all VITAM containers from {{docker_registry_external_hostname}} (except mongo)
  docker: 
    name="{{item}}-{{vitam_environment}}"
    image="{{docker_registry_external_hostname}}/vitam/{{item}}:{{vitam_docker_tag}}"
    signal=KILL
    state=stopped
  with_items:
  - "access"
  - "ihm-demo"
  - "ingest"
  - "ingest-web"
  - "logbook"
  - "metadata"
  - "processing"
  - "workspace"
  - "ingest-external"
  - "storage-engine"
  - "storage-offer-default"
  ignore_errors: true

- name: stop all VITAM containers from {{docker_registry_push_hostname}} (except mongo)
  docker: 
    name="{{item}}-{{vitam_environment}}"
    image="{{docker_registry_push_hostname}}/vitam/{{item}}:{{vitam_docker_tag}}"
    signal=KILL
    state=stopped
  with_items:
  - "access"
  - "ihm-demo"
  - "ingest"
  - "ingest-web"
  - "logbook"
  - "metadata"
  - "processing"
  - "workspace"
  - "ingest-external"
  - "storage-engine"
  - "storage-offer-default"
  ignore_errors: true



- name: delete all VITAM containers from {{docker_registry_hostname}} (except mongo)
  # shell: /usr/bin/docker ps -qa | xargs docker rm
  # ignore_errors: True
  docker_image: 
    name="{{docker_registry_hostname}}/vitam/{{item}}"
    state=absent
  with_items:
  - "access"
  - "ihm-demo"
  - "ingest"
  - "ingest-web"
  - "logbook"
  - "metadata"
  - "processing"
  - "workspace"
  - "ingest-external"
  - "storage-engine"
  - "storage-offer-default"
  - "functional-administration"
  ignore_errors: true
 
- name: delete all VITAM containers from {{docker_registry_external_hostname}} (except mongo)
  # shell: /usr/bin/docker ps -qa | xargs docker rm
  # ignore_errors: True
  docker_image: 
    name="{{docker_registry_external_hostname}}/vitam/{{item}}"
    state=absent
  with_items:
  - "access"
  - "ihm-demo"
  - "ingest"
  - "ingest-web"
  - "logbook"
  - "metadata"
  - "processing"
  - "workspace"
  - "ingest-external"
  - "storage-engine"
  - "storage-offer-default"
  - "functional-administration"
  ignore_errors: true

- name: delete all VITAM containers from {{docker_registry_push_hostname}} (except mongo)
  # shell: /usr/bin/docker ps -qa | xargs docker rm
  # ignore_errors: True
  docker_image: 
    name="{{docker_registry_push_hostname}}/vitam/{{item}}"
    state=absent
  with_items:
  - "access"
  - "ihm-demo"
  - "ingest"
  - "ingest-web"
  - "logbook"
  - "metadata"
  - "processing"
  - "workspace"
  - "ingest-external"
  - "storage-engine"
  - "storage-offer-default"
  - "functional-administration"
  ignore_errors: true

# name="{{item}}-{{vitam_environment}}"
- name: delete all VITAM containers from {{vitam_environment}} (except mongo)
  # shell: /usr/bin/docker ps -qa | xargs docker rm
  # ignore_errors: True
  docker_image: 
    name="{{item}}-{{vitam_environment}}"
    state=absent
  with_items:
  - "access"
  - "ihm-demo"
  - "ingest"
  - "ingest-web"
  - "logbook"
  - "metadata"
  - "processing"
  - "workspace"
  - "ingest-external"
  - "storage-engine"
  - "storage-offer-default"
  - "functional-administration"
  ignore_errors: true

# name="{{item}}-{{vitam_environment}}"
- name: delete all VITAM containers from {{vitam_environment}} with docker module (except mongo)
  # shell: /usr/bin/docker ps -qa | xargs docker rm
  # ignore_errors: True
  docker: 
    name="{{item}}-{{vitam_environment}}"
    image="{{item}}-{{vitam_environment}}"
    state=absent
  with_items:
  - "access"
  - "ihm-demo"
  - "ingest"
  - "ingest-web"
  - "logbook"
  - "metadata"
  - "processing"
  - "workspace"
  - "ingest-external"
  - "storage-engine"
  - "storage-offer-default"
  - "functional-administration"
  ignore_errors: true

#- name: delete all containers
#  shell: docker images -q | xargs docker rmi
#  ignore_errors: True

- name: delete /opt/vitam directory
  file:
    path="{{vitam_folder_root}}/{{item}}"
    state=absent
  with_items:
  - "access"
  - "ihm-demo"
  - "ingest"
  - "ingest-web"
  - "logbook"
  - "metadata"
  - "processing"
  - "workspace"
  - "ingest-external"
  - "storage-engine"
  - "storage-offer-default"
  - "functional-administration"
