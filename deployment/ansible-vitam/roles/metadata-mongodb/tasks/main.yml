---
#(user vitam / groupe vitam)
- name: Ensure VITAM directories exist to persist VITAM data, configuration and logs
  file: 
    name={{item}} 
    state=directory
    owner={{local_user}}
    group=vitam
    mode={{vitam_folder_permission}}
  with_items:
  - "{{vitam_folder_conf}}"
  - "{{vitam_folder_log}}"
  - "{{vitam_folder_data}}"

#- name: Deploy configuration files
#  template:
#    src="{{item}}.j2"
#    dest="{{vitam_folder_conf}}/{{item}}"
#    owner=vitam
#    group=vitam mode={{vitam_conf_permission}}
#  notify: restart container
#  with_items:
#  - "metadata.yml"

- name: Deploy MongoDB docker file
  docker:
    name: "{{vitam_docker_name}}"
    image: "{{docker_registry_hostname}}/mongo:{{vitam_docker_tag}}"
    state: started
    restart_policy: always
    pull: "{{pull_strategy}}"
    ports:
      - "{{vitam_docker_port_mongodb}}:27017"
    volumes: 
      #- "{{vitam_folder_conf}}:/vitam/conf" # TODO: KWA specify custom configuration file
      #- "{{vitam_folder_log}}:/var/log/mongodb" # TODO: KWA verify logging for mongo
      - "{{vitam_folder_data}}:/data/db"
