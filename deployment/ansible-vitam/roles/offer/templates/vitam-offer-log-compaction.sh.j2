#!/usr/bin/env bash
set -e

CURRENT_DIR="$( cd "$( readlink -f $(dirname ${BASH_SOURCE[0]}) )" ; pwd )"
OFFER_LOG_URL="http://{{ ip_admin }}:{{ vitam.storageofferdefault.port_admin }}/offer/v1/compaction"

function log() {
    LEVEL=${1}
    MSG=${2}
    TIMESTAMP=$( date +"%Y-%m-%d %H:%M:%S" )
    echo ${TIMESTAMP} [[vitam-storage-offerlogs-compactions]] [vitam-storage-offerlogs-compactions] ${LEVEL} vitam-offer-log-compaction.sh - vitam-storage-offerlogs-compactions.service : [${HOSTNAME}:vitam-storage-offerlogs-compactions.service:0] ${MSG}
}

function local_curl() {
    COLLECTION=${1}
    curl -s -X POST -H "X-Tenant-Id: {{ vitam_tenant_admin }}" -H "Content-Type: application/json" -H "Accept: application/json" --data '{"expirationValue": "{{ expiration_valueÂ }}", "compactionSize": "{{ compaction_size }}", "expirationUnit": "{{ expiration_unit }}"}' ${OFFER_LOG_URL}
    log "INFO" "${MSG}"
}

# Main
local_curl
