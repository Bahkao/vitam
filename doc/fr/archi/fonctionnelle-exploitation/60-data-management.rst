Gestion des données du système
##############################

Sauvegarde
==========

Vue d'ensemble
--------------

.. caution:: La sauvegarde des données du système se fait à froid dans cette version du système ; par conséquent, une plage d'indisponibilité complète du service est à prévoir (par la suite, cette plage d'indisponibilité sera considérée comme étant la nuit entre 20h00 et 08h00, cette durée pouvant être adaptée en fonction de la volumétrie des sauvegardes à réaliser).

La sauvegarde s'effectue pendant la nuit, avec globalement 5 phases :

- Une phase initiale de suppression des possibilités d'écritures externes dans les bases de données (arrêt des composants frontaux) ;
- Une phase d'attente de la fin des processus internes en cours (workflow d'entrée et sécurisation des journaux) ; cette phase se clôt par l'arrêt ordonné de tous les services VITAM ;
- Une phase d'export des bases de données sous forme de fichiers ;
- Une phase de sauvegarde des fichiers (avec a minima les fichiers d'archives et fichiers d'export des bases de données) ;
- Une phase de redémarrage ordonné des services VITAM.

La figure suivante décrit plus en détail ce processus :

.. figure:: images/backup-process.*
    :align: center

    Vue d'ensemble du processus de backup VITAM

.. seealso:: Ce processus est décrit plus en détails dans :doc:`la description des besoins en ordonnancement </technique/10-it-services>`

.. Mentionner la sauvegarde du système de gestion des logs
.. (mentionner les grandes lignes des principes de stockage / backup / restauration des données)

Dossiers
--------

Les dossiers suivants sont éligibles aux processus de sauvegarde (dans l'ordre décroissant de criticité) :

* ``/vitam/data`` : ce répertoire contenant les données des applications, sa sauvegarde est vitale.
* ``/vitam/tmp`` : la sauvegarde de ce répertoire est optionnelle ; elle peut permettre de diminuer le temps de reprise après incident.
* ``/vitam/conf`` : la sauvegarde de la configuration est normalement peu utile, car tous les fichiers de configuration sont gérés par ansible, donc facilement réinstanciables.

Les autres répertoires sont intégralement fournis par les packages d'installation ; leur sauvegarde n'est donc pas indispensable.


.. Utilisation des outils fournis (ex: mongodump pour la sauvegarde de mongo) à aborder dans la description des services (dans l'architecture technique)

Restauration
============

.. todo:: Ce sujet sera adressé dans une future version de ce document.